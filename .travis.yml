language:
  - cpp

matrix:
  include:
    - os: linux
      dist: trusty
      sudo: required
      compiler: gcc
      addons:
        apt:
        sources:
          - ubuntu-toolchain-r-test
        packages:
          - gcc-6
          - g++-6

    - os: linux
      dist: trusty
      sudo: required
      compiler: clang
      addons:
        apt:
        sources:
          - ubuntu-toolchain-r-test
          - llvm-toolchain-precise-5.0
        packages:
          - clang-5.0
      env:
        - MATRIX_EVAL="CC=/usr/local/clang-5.0.0/bin/clang-5.0 && CXX=/usr/local/clang-5.0.0/bin/clang++"

    - os: osx
      compiler: clang
      osx_image: xcode9.4

    - os: osx
      compiler: gcc
      osx_image: xcode10.1

before_install:
  - eval "${MATRIX_EVAL}"
  - if [ ${TRAVIS_OS_NAME} == "linux" ]; then
      sudo apt-get install libgtest-dev;
      sudo apt-get remove cmake cmake-data;
      sudo -E add-apt-repository -y ppa:george-edison55/cmake-3.x;
      sudo -E apt-get update;
      sudo apt-get install cmake;
    fi

install:
  #- if [ "${TRAVIS_COMPILER}"" == "clang" ]; then
  #  export CC=/usr/bin/clang;
  #  export CXX=/usr/bin/clang++;
  #  fi
  - if [ ${TRAVIS_OS_NAME} == "linux" ]; then
      cd /usr/src/gtest;
      sudo cmake -DBUILD_SHARED_LIBS=ON;
      sudo make;
      sudo cp *.so /usr/lib;
    fi
  - if [ ${TRAVIS_OS_NAME} == "osx" ]; then
      cd ~/;
      git clone https://github.com/google/googletest.git;
      cd googletest;
      mkdir install;
      cd install;
      cmake ../;
      make;
      sudo make install;
      source ~/.bash_profile;
    fi

script:
  - if [ ${TRAVIS_OS_NAME} == "linux" ]; then
      sudo ln -s /usr/bin/gcc-6 /usr/local/bin/gcc;
      sudo ln -s /usr/bin/g++-6 /usr/local/bin/g++;
      cd /home/travis/build/lbcb-edu/BSc-project-20-21;
    fi
  - if [ ${TRAVIS_OS_NAME} == "osx" ]; then
      cd /Users/travis/build/lbcb-edu/BSc-project-20-21;
    fi
  - mkdir build
  - cd build
  - sudo cmake ../src -Dmapper_build_tests=ON -Dbuild_mapper=OFF
  - sudo cmake --build .
  - ./pink_mapper_test